# 1 前言

日活用户为 1 的系统，日活用户为 10,000 的系统，日活用户为 100,000,000 的系统，它们之间采用的架构设计是截然不同的。随着系统变得复杂，如果我们不采取相应的措施，系统的性能一定会下降。所谓的可扩展性，就是当系统变得复杂的时候，我们能够很轻易地去应对这种复杂性、轻易地提高系统的性能。不用重构系统。

# 2 系统是怎么变得复杂的？

系统会随着以下几点变得复杂：

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/d8af1751-0bc1-46bb-8110-cee8ae6ef846)

## 2.1 用户量变多

系统的用户量逐渐变多，导致接口请求变多，例如：一个社交媒体平台有越来越多的用户使用。

## 2.2 功能变多

系统的功能逐渐变多，例如：一个电商网站支持多种不同的付款方式，微信付款、支付宝付款、抖音付款......

## 2.3 数据量变多

用户量变多，导致系统存储的用户数据变多，例如：一个视频网站，像哔哩哔哩，存储的视频数据量随着时间慢慢变多。

## 2.4 系统架构变得复杂

为了适应复杂的功能和逐渐变多的用户量，系统的架构也在不断发展，从而产生额外的东西和依赖，例如：一个原本只有一个进程的系统，后续变成了多个进程相互配合。原本只需要一台机器的系统，后续变成了多台机器相互配合。

## 2.5 全球化

为了能够满足全球用户的访问，系统需要扩展到新的国家和地区去服务对应的用户，例如：一家电商公司，在不同的国家和地区都有部署他们的产品。

# 3 如何扩展一个系统？

下面是 10 个常用的方法来去扩展一个系统，也可以理解为如何增强一个系统的性能：

## 3.1 垂直扩展

这就意味着增强单台机器的性能，例如加多点内存、加多点 CPU、加多点磁盘，如果系统是单机的话，这样的垂直扩展是简单且有效的，但是单台机器的扩展也有一个上限（单台机器的内存不可能无限增多）。

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/efc161e9-a223-42e5-bd31-cc2b00948ca5)

## 3.2 水平扩展

这就意味着向系统添加更多计算机以将工作负载分散到多个机器上。它通常被认为是扩展大型系统的最有效方法。例如：Netflix 公司对其流媒体服务采用水平扩展，在集群中添加更多服务器来处理不断增长的用户数量和数据流量。

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/a7dbd8d2-33c7-4ab5-b4a7-4f1c65245dfe)

## 3.3 负载均衡

负载平衡是在多个服务器之间分配流量的过程，以确保没有任何一个服务器被压垮。例如：Google 公司在其全球基础设施中广泛采用负载平衡，以在其庞大的服务器群中均匀分配搜索查询和流量。

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/a69ee311-6834-45cf-8bd1-6c1c4d075e45)

## 3.4 缓存

将经常访问的数据存储在内存（如 RAM）中，以减少磁盘 IO 的负载。使用缓存可以显着缩短响应时间。例如：Reddit 公司使用缓存来存储频繁访问的内容，如热门帖子和评论，以便可以快速提供这些内容，而无需每次都查询数据库。

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/c4aa365a-9eb0-4d77-88c8-aa9c8c76b4c5)

## 3.5 内容分发网络（CDN）

将静态资源（图像、视频等）分发到离用户更近的地方。这可以减少延迟并加快加载时间。例如：Cloudflare 提供 CDN 服务，通过在靠近用户的服务器中缓存内容来加快全球用户的网站访问速度。

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/2cfd7d61-2720-4a9a-8787-6cc0802baf35)

## 3.6 分片

将数据或功能拆分到多个节点/服务器以分配工作负载来避免单机瓶颈。例如：Redis 数据库的 cluster 模式，将整个键空间分成了 16384 个槽，多个服务器组成的集群，每个服务器平分这些槽，突破了单机内存上限。

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/12893a94-f816-417d-bc3d-78ff7531305e)

## 3.7 异步通信

将长时间运行或非关键任务放到后台队列或消息队列。确保应用程序能够快速响应用户的请求。例如：Slack 这个软件使用异步通信进行消息传递。发送消息时，发送者界面不会冻结；当消息在后台处理和传递时，它会继续响应。

## 3.8 微服务架构

将您的应用程序分解为更小的、独立的、可以独立扩展的服务。这提高了弹性，并允许团队并行处理不同服务。例如：Uber 公司已将其架构发展为微服务，以独立处理计费、通知和叫车等不同功能，从而实现高效扩展和快速开发。

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/ece4e846-d103-42e2-a71e-9dc794a86590)

## 3.9 自动扩容

根据当前负载自动调整服务器数量。这确保系统无需人工干预即可处理流量高峰。例如：AWS Auto Scaling 监控应用程序并自动调整容量，以尽可能低的成本保持稳定、可预测的性能。

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/f9b89cf1-42a6-4bd6-b1f4-894957f13fe4)

## 3.10 多机房部署

将应用程序部署在多个数据中心或云服务中，以减少延迟并实现高可用。例如：Spotify 使用多区域部署来确保其音乐流媒体服务保持高可用性并响应世界各地的用户，无论他们位于何处。

参考：

https://newsletter.ashishps.com/p/scalability
