# 1 什么是垂直扩展和水平扩展

垂直扩展指的是提升现有机器的性能，例如加多点内存、加多几个 CPU、加大磁盘容量等，但是机器的数量没有改变；水平扩展就是通过部署新的机器，组成一个集群来对外提供服务，机器的数量变多了。（虽然上面说的是增强，但是广义的扩展也可以是缩小，例如流量大的时候增强机器的性能，流量小的时候就可以减少机器的性能）

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/91cd0c3e-ed97-4afe-87c1-0b715c2ffaf9)

线上流量忽高忽低，如果我们的软件产品不能适应这种流量变化，那么就很容易让能够适应这种变化的竞争对手超过我们，正是因为可扩展性是云服务的一个重要特性，许多企业都将他们的产品部署在云服务上。云扩展主要通过两种方式进行：水平和垂直。两种扩展方法都增强了系统在处理能力、数据存储和网络功能方面的能力。然而，虽然垂直扩展是使用现有基础设施进行的，但水平扩展则依赖于新基础设施的部署。

云服务之所以容易扩展，是虚拟化技术应用的结果，虚拟机由背后的物理资源提供支持，可以提供与物理机一样的计算能力，虚拟机提供的灵活性使它们能够轻松扩展或缩小，即在需要时将现有工作负载转移到更大或更小的虚拟机。在这些虚拟机上处理和存储的工作负载和应用程序可以转移到不同的服务器，甚至同时转移到多个服务器，这是横向扩展的一个例子。

使用第三方供应商的云服务使企业能够利用这些提供商已经部署的大量软件和硬件资源来满足其扩展需求。第三方云服务提供的快速扩展对于个体企业来说可能无法经济高效地实现。

企业利用可扩展的云模型来满足不断变化的客户需求并提高盈利能力。云可扩展性使公司能够以快速、高效和有竞争力的方式工作。事实上，可扩展性是将业务流程迁移到云的关键优势之一。

对云带宽的需求可能会突然激增、逐渐增加，甚至随着时间的推移而减少。无论情况如何，云可扩展性都允许企业通过立即且经济高效地增加或减少性能和存储能力来做出适当的响应。接下来，让我们详细了解这些扩展方法。

# 2 水平扩展

水平云扩展也称为“横向扩展”，通过添加新的计算基础设施来提高云吞吐量。简单来看，横向扩展意味着添加新的计算节点或机器以增强数据处理和存储能力。水平扩展主要适用于需要高可用性和近乎零停机时间的在线服务。与垂直扩展相比，水平扩展更快更容易完成。一般来说，它使用最少的停机时间和最少的中断情况。

# 3 垂直扩展

垂直云扩展通过添加或更换CPU、HDD或其他组件来增强现有基础设施的技术规格。放弃现有系统并用更高性能的基础设施替换它们也属于垂直扩展。旧的基础设施要么被丢弃报废、转售，要么被重新用于不太重要的业务流程。与水平扩展相比，垂直扩展可能需要更长的时间，并且可能需要一段时间的停机时间。然而，扩展通常比扩展更便宜。使用第三方云供应商的服务可以简化企业的垂直扩展。这是因为确保足够的云计算资源来满足可扩展性需求成为服务提供商的责任。对于最终用户来说，扩展就像在 Web 界面上修改实例大小一样简单。

# 4 水平云扩展和垂直云扩展的相同点

无论云服务是水平扩展还是垂直扩展，两种扩展方法都有许多相似之处。以下是水平云扩展和垂直云扩展之间的一些关键相似之处。

![image](https://github.com/kyiree/system-design-gpt/assets/64623867/553d1387-7f83-4262-9e54-1b26e12a7657)

## 4.1 提升计算速度和存储

计算和存储仍然是企业最常见的云的两个用途。云扩展可帮助企业按所需规模处理和存储关键数据和应用程序。通过增强云计算和存储能力，企业可以安全地托管应用程序并存储敏感的客户数据。确保满足这些业务需求对于任何组织都至关重要。计算和存储的灵活性对于刚刚起步的组织特别有用。初创公司可能只需要处理和存储几 TB 的信息来开始其旅程。然而，即使是一个普通的工作日也可能导致这一数据迅速增加。借助云可扩展性，此类企业将能够轻松管理这些增加的工作负载。无论您选择扩大规模还是减小规模，都可以让吸引新客户和迎合新客户变得轻而易举。计算和存储数据成为一种始终在线的操作，客户将不必面临停机或响应时间缓慢的问题。

## 4.2 增强业务处理能力

云可扩展性彻底改变了业务基础设施的理念。 “固定容量”系统的想法正在慢慢成为过去。即使规模较小的公司也能够访问强大的云资源，以所需的规模增强其工作流程和其他业务能力。企业界对用于业务开发和数据分析的强大云软件的需求正在稳步增长。公司可以扩展其系统以增强其业务能力。纵向扩展（或横向扩展）允许企业利用云来开发产品和服务，以所需的规模实现所需的业务成果。实施正确的扩展意味着在正确的时间访问正确的基础设施很少会出现问题。公司不再需要担心客户对他们来说“太大”。相反，只要需要改进业务能力，他们就可以增加云计算资源。此外，当业务功能未使用时，可以缩小（或缩小）它们以最大限度地降低成本。

## 4.3 提高灵活度

灵活度是云可扩展性的核心优势。新冠肺炎 (COVID-19) 疫情过后，许多跨行业的企业已转向线上。这使得动态能力成为日常业务运营的常规组成部分。需要灵活的基础设施来应对这一挑战并取得长期成功。可扩展的云基础设施使企业能够重塑其系统以适应不断变化的工作负载。事实上，一些公司从一开始就采用可扩展的云架构和应用程序。这使他们能够轻松地将私有云网络转变为混合云或多云环境，以解决相关的业务问题。无论是什么类型的扩展，云的可扩展性都为公司提供了巨大的灵活度。它使他们能够在扩展云基础设施以满足现有和可预见的业务需求时应对运营挑战以及监管和法律要求。

## 4.4 减少响应时间

云可扩展性有助于最大限度地缩短企业响应客户所需的时间。自动扩展流程意味着客户甚至不需要等待公司手动扩展其系统。这有助于确保客户无需等待过长的时间才能得到答复。只需设置参数，您的云平台就会根据带宽需求自动扩展或收缩。

## 4.5 增强创新能力

两种类型的可扩展云解决方案都有助于有效管理不同业务资产的吞吐量。这使得 IT 人员无需持续监控和响应带宽问题。技术团队可以花更多时间创建和改进创新解决方案，将重心转向重要的业务流程。

## 4.6 最大化成本效益和盈利能力

最后是水平扩展和垂直扩展之间的核心相似之处，即最大的成本效益和盈利能力。云计算可以帮助各种规模的公司降低与基础设施相关的成本。正是因为自动扩展的特性，旺季的时候增加云计算的能力，淡季的时候减少云计算的能力来减少成本，而不是使用固定的机器导致固定的成本。

# 5 水平云扩展与垂直云扩展的不同点

虽然水平扩展和垂直扩展有许多相同点，它们也有很多不同之处，下面是它们的主要不同之处：

## 5.1 编程范式：

| 水平扩展 | 垂直扩展 | 
|-------|-------|
| 水平扩展利用多个物理机器相互配合。主要关注分布式编程 | 垂直扩展利用单个物理机器上的并发编程。主要关注多进程编程或者多线程编程。 |

## 5.2 主要特性和例子

| 水平扩展 | 垂直扩展 | 
|-------|-------|
| 水平可扩展性具有强大的负载平衡、分布式文件系统和集群的特点。这使得流量能够在更高的水平上得到更有效的监管。容错机制在水平扩展环境中也更加突出。水平扩展的主要例子包括 MongoDB 和 Cassandra。 | 垂直可扩展性的突出特点是它以单一系统的形式存在，易于实施和维护。扩展时应用程序不兼容的风险最小。这种形式的扩展更适合数据吞吐量要求较低的小型组织。垂直扩展的突出例子包括 Amazon RDS 和 MySQL。 |

## 5.3 地理分布

| 水平扩展 | 垂直扩展 | 
|-------|-------|
| 水平扩展是增强应用程序地理范围的理想选择。水平扩展可最大程度地减少地理延迟，有助于确保法规遵从性并增强业务连续性。 | 垂直扩展对于需要有限地理存在的应用程序来说是理想的选择。垂直扩展最适合为特定区域内的客户提供服务的公司。 |

## 5.4 数据传输、一致性问题

| 水平扩展 | 垂直扩展 | 
|-------|-------|
| 水平扩展使用网络通信（也称为“调用”）在机器之间传输数据。这些调用可能很慢并且可能会失败。存在分布式事务问题。最后，水平扩展需要负载均衡组件。这是在涉及的众多机器之间分配流量所必需的。 | 垂直扩展基于进程间通信或线程间通信的原理进行操作。这种可扩展性方法更快、更直接。由于扩容涉及一台机器来处理所有请求，因此不存在“数据不一致”的问题。即使是多线程环境通常也具有共享地址空间。这使得数据共享可以通过引用的传递来完成。最后，整个数据负载由一台机器处理。这消除了对负载平衡器的需要。 |

## 5.5 成本

| 水平扩展 | 垂直扩展 | 
|-------|-------|
| 水平扩展的绝对成本通常比垂直扩展的绝对成本高得多。这是因为水平扩展涉及多个物理机器，通常分布在不同地理位置的多个数据中心。然而，水平扩展可以帮助拥有适当用例的企业提高盈利能力 | 垂直扩展通常是水平扩展的低成本替代方案。这是因为单台机器的操作、维护和管理更加经济。随着通过高端组件来提高单台机器的容量，与垂直扩展相关的盈利能力比以往任何时候都更好。 |

## 5.6 停机时间

| 水平扩展 | 垂直扩展 | 
|-------|-------|
| 在水平扩展支持的环境中，停机时间很少见。这是因为存在多台机器同时处理请求。如果某些机器停止运行，其他机器将承担其工作量。 | 依赖垂直扩展的环境更容易发生停机。这是因为所有工作负载都在一台机器上处理。无论这台机器的能力多么强大，其操作中的任何问题都可能会带来停机风险。 |

## 5.7 灵活度

| 水平扩展 | 垂直扩展 | 
|-------|-------|
| 水平扩展非常灵活，因为可以部署多少台机器来处理工作负载没有上限。这使得从性能和成本角度选择最佳配置成为可能。灵活性也体现在运营成本上——当您需要“缩小规模”时，您可以简单地关闭在给定时刻不需要的机器。 | 垂直扩展不可能超出单台机器的上限。此外，提高机器的规格通常会导致停机。垂直扩展在成本灵活性方面也落后了——日常运营的成本基本上是根据所使用的硬件固定的。 |

## 5.8 升级

| 水平扩展 | 垂直扩展 | 
|-------|-------|
| 升级现有系统的功能不需要断开服务。因此，水平扩展对于需要峰值性能水平的永久可用性的企业来说是理想的选择。 | 如果不停机，垂直扩展的能力就无法增强。这是因为所有操作都在一台机器上进行，通常需要关闭该机器进行升级。 |

# 6 选择水平扩展还是垂直扩展

水平扩展和垂直扩展各有它们的优势和劣势，所以我们该怎么选择呢？

第一个要考虑的因素是应用程序的架构。首先确定您的业务目标以及实现这些目标的技术栈。然后，咨询所有利益相关者，了解哪些业务领域可以通过云扩展获得价值。

接下来，组织内部的技术专家（如果需要，也可以包括外部的技术专家）。利用这些专业知识，根据架构、业务流程和利益相关者做出关键决策。可以帮助您更好地了解组织的云扩展需求的因素包括应用程序的性能要求及其技术特征，例如峰值性能所需的系统吞吐量、可用性和响应时间。

先开发一个基本的 demo 以了解每个云扩展模型在实践中的样子。demo 启动并运行后，测试其生产力、可靠性、容错性和成本效益。确保调查结果与您的短期、中期和长期云扩展目标同步。

无论您选择哪种方法，它都应该回答上述问题。然而，每个组织都有不同的用例，这些问题只是一个开始的方法。与跨部门的利益相关者合作，提出更多与您的组织相关的问题。然后，努力尽可能准确、详尽地回答这些问题。短期内看起来工作量很大，但云扩展是一项长期承诺。满足您组织当前需求的解决方案不一定在五到十年后也能满足您的组织需求。一旦您的需求明确，请与技术专家合作，了解您的应用程序是否能够真正在所选架构下运行。如果这两种方法似乎都不完美，请考虑大多数领先的科技企业使用这两种方法的组合来满足其可扩展性要求。这种混合方法可以帮助您将垂直扩展的可靠性和速度与水平扩展提供的无限可扩展性和强大的业务连续性结合起来。请记住，无论您选择哪种方法，您始终都必须在一些因素上做出妥协。

# 6 最后

无论您选择水平还是垂直云扩展，请记住，随机部署新硬件或组件永远不是最好的方式。在没有首先仔细研究应用程序的技术需求的情况下添加更多机器或节点可能会导致瓶颈、不一致和总体上达不到最优解的环境。

如果您不确定，请查看增加容量或修改现有机器的规格是否可以满足您的业务需求。在这种情况下，请选择垂直扩展，特别是如果您刚刚起步。一旦您确信您的用户（以及数据吞吐量）即将呈指数级增长，那么可能就是选择水平或混合扩展模型的最佳时机。

参考

https://www.spiceworks.com/tech/cloud/articles/horizontal-vs-vertical-cloud-scaling/
